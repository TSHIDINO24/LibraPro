<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Boxicons -->
    <link href='https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css' rel='stylesheet'>
    <!-- My CSS -->
    <link rel="stylesheet" href="css/dashboardstyle.css">
    <title>LibraPro Library - Manage Books</title>
<style>
    .popup-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 1000;
    display: flex;
    justify-content: center;
    align-items: center;
}

.popupForm {
	background-color: #ffffff;
	border-radius: 8px;
	box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
	padding: 20px;
	text-align: center;
	position: relative;
	width: 450px;
}

.closePopup {
	position: absolute;
	top: 10px;
	right: 10px;
	font-size: 14px;
	background: none;
	border: none;
	cursor: pointer;
	color: #333;
}

.closePopup:hover {
	color: #555;
}

.form-input {
	margin-bottom: 15px;
}

label {
	display: block;
	margin-bottom: 5px;
	font-weight: bold;
}

input {
	width: 100%;
	padding: 8px;
	border: 1px solid #ccc;
	border-radius: 4px;
	font-size: 14px;
}

.btn-submit {
	background-color: #fc8010;
	color: #fff;
	border: none;
	padding: 10px 15px;
	border-radius: 4px;
	cursor: pointer;
	font-size: 14px;
}

.btn-submit:hover {
	background-color: #333;
}
</style>
</head>


<body>
 <!-- SIDEBAR -->
 <section id="sidebar">
	<a href="#" class="brand">
		<i class='bx bxs-book'></i>
		<span class="text">LibraPro</span>
	</a>
	<ul class="side-menu top">
		<li>
			<a href="index.html" class="nav-link.manage-users">
				<i class='bx bxs-dashboard'></i>
				<span class="text">Dashboard</span>
			</a>
		</li>
		<li>
			<a href="ManageUsers.html" class="nav-link.manage-users">
				<i class='bx bxs-user'></i>
				<span class="text">Manage Users</span>
			</a>
		</li>
		<li>
			<a href="ManageBooks.html" class="nav-link">
				<i class='bx bxs-book'></i>
				<span class="text">Manage Books</span>
			</a>
		</li>
		<!--li>
				<a href="ManageDamagedBooks.html" class="nav-link">
					<i class='bx bxs-book'></i>
					<span class="text">Manage Damaged Books</span>
				</a>
			</li-->
		<!--li>
			<a href="FineManagement.html" class="nav-link">
				<i class='bx bxs-book'></i>
				<span class="text">Manage Fines</span>
			</a>
		</li>
		<li>
			<a href="NotificationPage.html" class="nav-link">
				<i class='bx bxs-message-dots' ></i>
				<span class="text">Notifications</span>
			</a>
		</li-->
		<li>
			<a href="PendingOrders.html" class="nav-link">
				<i class='bx bxs-message-dots' ></i>
				<span class="text">Pending Orders</span>
			</a>
		</li>
		<li>
			<a href="CheckedOutBooksPage.html" class="nav-link">
				<i class='bx bxs-shopping-bag-alt'></i>
				<span class="text">Checked Out Books</span>
			</a>
		</li>
		<li>
			<a href="\LibraProWeb\index.html" class="nav-link">
				<i class='bx bxs-user'></i>
				<span class="text">Logout</span>
			</a>
		</li>
	 </ul>
	</div>
	</section>
<!-- SIDEBAR -->

   <!-- CONTENT -->
	<main id="content">
        
   <!-- NAVBAR -->
   <nav>

    <a href="#" class="nav-link"></a>
    <form action="#">

    </form>
    <input type="checkbox" id="switch-mode" hidden>
    <a href="#" class="notification">
        <i class='bx bxs-bell'></i>
        <span id="notificationCount" class="num">0</span>
    </a>
    <ul id="notificationList"></ul>

    <div class="dropdown">
        <a href="#" class="profile">
            <img src="img/user.png">
        </a>
        <div class="dropdown-content">
            <a href="\LibraProWeb\index.html">LogOut</a>
            <a href="#">Settings</a>
        </div>
    </div>
</nav>
<!-- NAVBAR -->

<main>
    <ul class="box-info"> 
    <li>
            <i class='bx bxs-book'></i>
            <!--<span class="icon">
                <img src="img/books.png">
            </span> -->
            <span class="text">
                <h3 id="BooksTotal">0</h3>
                <p>Books</p>
            </span>
    </li>
    <li>
        <i class='bx bxs-category'></i> 
        <!--<span class="icon">
            <img src="img/books.png">
        </span>-->
        <a href="ViewBooks.html" class="button-link">
            <span class="text">
                <p>View Books</p>
            </span>
        </a>
    </li>

    <li>
        <i class='bx bxs-book'></i> 
        <!--<span class="icon">
            <img src="img/books.png">
        </span>-->
        <a href="#" class="button-link" id="showPopupAdd">
            <span class="text">
                <p>Add Books</p>
            </span>
        </a>
    </li>

    <li>
        <i class='bx bxs-category'></i> 
        <!--<span class="icon">
            <img src="img/books.png">
        </span>-->
        <a href="#" class="button-link" id="showPopupCategory">
            <span class="text">
                <p>Add Category</p>
            </span>
        </a>
    </li>
    </ul>
    <div id="successPopup" class="popup-overlay" style="display: none;">
        <div class="popupForm">
            <button class="closePopup" id="closeSuccessPopup">x</button>
            <p id="successMessage"></p>
        </div>
    </div>
</main>

    <!-- ADD BOOK FORM -->
    <div class="popup-overlay" id="popupOverlayAdd" style="display: none;">
        <div class="popupForm">
            <button class="closePopup" id="closePopupAdd">x</button>
            <h2>Add Book</h2>
            <form>
            <div class="form-input">
                <label for="title">Title:</label>
                <input type="text" id="title" required>
            </div>
            <div class="form-input">
                <label for="author">Author:</label>
                <input type="text" id="author" required>
            </div>
            <div class="form-input">
                <label for="description">Description:</label>
                <textarea id="description" rows="1" cols="55" required></textarea>
            </div>
            <div class="form-input">
                <label for="quantity">Quantity:</label>
                <input type="number" id="quantity" required>
            </div>
            <div class="form-input">
                <label for="image">Image:</label>
                <input type="text" id="image" required>
            </div>
            <div class="form-input">
                <label for="isbn">ISBN:</label>
                <input type="text" id="isbn" required>
            </div>
            <div class="form-input">
                <label for="category">Category:</label>
                <select id="category" required>
                </select>
            <div>
                <button type="submit" class="btn-submit" id="addBookBtn">Add New Book</button>
            </div>
        </form>
    </div>
</main>

<div id="successPopup" class="popup-overlay" style="display: none;">
    <div class="popupForm">
        <button class="closePopup" id="closeSuccessPopup">x</button>
        <p id="successMessage"></p>
    </div>
</div>

<script src="https://unpkg.com/boxicons@2.1.3/dist/boxicons.js"></script>

<script>

/////////////////////////////////////////////////////////////////TOTALS
// Function to fetch data from the API
async function TotalfetchData(apiEndpoint) {
    try {
        const response = await fetch(apiEndpoint);
        const data = await response.json();
        return data;
    } catch (error) {
        console.error('Error fetching data:', error);
        return null;
    }
}

document.addEventListener("DOMContentLoaded", async function() {
    const booksData = await TotalfetchData('https://localhost:44310/api/Book/allbooks');

    if (booksData) {
        const bookTotal = booksData.reduce((total,book)=> total + book.bookQuantity,0);
    
        document.getElementById("BooksTotal").textContent = bookTotal;
       
    }
});


// Function to show a success pop-up message
function showSuccessPopup(message) {
    const successPopup = document.getElementById('successPopup');
    const successMessage = document.getElementById('successMessage');
    successMessage.textContent = message;
    successPopup.style.display = 'flex';

    // Close the success pop-up when the close button is clicked
    document.getElementById('closeSuccessPopup').addEventListener('click', function () {
        successPopup.style.display = 'none';
    });
}

           // Event listener for the "Add Book" button
            document.getElementById('showPopupAdd').addEventListener('click', function () {
            const popupOverlayAdd = document.getElementById('popupOverlayAdd');
            popupOverlayAdd.style.display = 'flex';
        });

        // Event listener for the "Close" button in the "Add Book" form
        document.getElementById('closePopupAdd').addEventListener('click', function () {
            const popupOverlayAdd = document.getElementById('popupOverlayAdd');
            popupOverlayAdd.style.display = 'none';
        });


        document.addEventListener("DOMContentLoaded", function () {
    // Fetch categories data from the API
    fetch('https://localhost:44310/api/Category/getallcategories')
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            if (Array.isArray(data)) {
                console.log('Fetched data:', data);
                // Populate the category select field
                populateCategorySelect(data);
            } else {
                throw new Error('Invalid JSON data received from the API');
            }
        })
        .catch(error => {
            console.error('Error fetching or parsing data:', error);
        });
});

// Function to populate the category select field
function populateCategorySelect(categories) {
    const categorySelect = document.getElementById('category');
    categories.forEach(category => {
        const option = document.createElement('option');
        option.value = category.categoryId;
        option.text = category.categoryName;
        categorySelect.appendChild(option);
    });
}


// Event listener for the "Add Book" button
document.getElementById('addBookBtn').addEventListener("click", function (event) {
    event.preventDefault(); // Prevent form submission

    // Get data from the form fields
    const bookData = {
        bookTitle: document.getElementById("title").value,
        bookAuthor: document.getElementById("author").value,
        bookDescription: document.getElementById("description").value,
        bookQuantity: parseInt(document.getElementById("quantity").value),
        bookImage: document.getElementById("image").value,
        isbn: document.getElementById("isbn").value,
        categoryId: parseInt(document.getElementById("category").value),
        categoryName: document.getElementById("category").options[document.getElementById("category").selectedIndex].text
    };

    // Send a POST request to the API to add the new book
    fetch('https://localhost:44310/api/Book/addbook', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(bookData),
    })
    .then(response => {
        if (response.ok) {
            return response.json(); // Parse the JSON response
        } else {
            return response.json().then(errorData => {
                throw new Error('Failed to add book: ' + JSON.stringify(errorData));
            });
        }
    })
    .then(newBook => {
        console.log('New book added:', newBook);

        // Show a success pop-up message
        showSuccessPopup("Book added to database");

        // Clear the form fields
        document.getElementById("title").value = '';
        document.getElementById("author").value = '';
        document.getElementById("description").value = '';
        document.getElementById("quantity").value = '';
        document.getElementById('image').value = '';
        document.getElementById('isbn').value = '';
        document.getElementById('category').value = '';
    })
    .catch(error => {
        console.error('Error adding book:', error);
    });
});

</script>
    
    <!--<script src="https://rawgit.com/schmich/instascan-builds/master/instascan.min.js"></script> -->
</body>

</html>